{% extends "base.html" %}

{% block title %}Stop Sign Debug{% endblock %}

{% block head_extra %}
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest" defer></script>
<script src="/static/js/video-player.js" defer></script>
<script src="/static/js/debug.js" defer></script>
{% endblock %}

{% block content %}
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 8px;">
    {# Video stream #}
    <div class="window">
        <div class="title-bar">
            <span class="title-bar-text">Video Stream</span>
            <div class="title-bar-controls">
                <button aria-hidden="true" tabindex="-1">&#9472;</button>
                <button aria-hidden="true" tabindex="-1">&#9723;</button>
            </div>
        </div>
        <div class="window-body-flush">
            <div hx-get="/load-video" hx-trigger="load"
                 class="sunken-dark"
                 style="display: flex; align-items: center; justify-content: center; min-height: 300px; aspect-ratio: 16/9;">
                <span style="color: var(--text-muted); font-size: 12px;" class="mono">Loading...</span>
            </div>
        </div>
    </div>

    {# Controls column #}
    <div style="display: flex; flex-direction: column; gap: 8px;">
        {# Zone selection #}
        <div class="window">
            <div class="title-bar">
                <span class="title-bar-text">1. Select Zone</span>
            </div>
            <div class="window-body">
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <button id="zone-stop-line" onclick="selectZoneType('stop-line')" class="btn98" style="font-size: 10px;">Stop Line</button>
                    <button id="zone-pre-stop" onclick="selectZoneType('pre-stop')" class="btn98" style="font-size: 10px;">Pre-Stop</button>
                    <button id="zone-capture" onclick="selectZoneType('capture')" class="btn98" style="font-size: 10px;">Capture</button>
                </div>
                <p id="zone-instructions" style="font-size: 10px; color: var(--text-muted); margin: 4px 0 0;"></p>
            </div>
        </div>

        {# Visualization #}
        <div class="window">
            <div class="title-bar">
                <span class="title-bar-text">2. Visualization</span>
            </div>
            <div class="window-body">
                <button id="debugZonesBtn" onclick="toggleDebugZones()" class="btn98" style="font-size: 10px;">Show Zones</button>
            </div>
        </div>

        {# Edit zone #}
        <div class="window">
            <div class="title-bar">
                <span class="title-bar-text">3. Edit Zone</span>
            </div>
            <div class="window-body">
                <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                    <button id="adjustmentModeBtn" onclick="toggleAdjustmentMode()" class="btn98" style="font-size: 10px;">Adjust</button>
                    <button onclick="resetPoints()" class="btn98" style="font-size: 10px;">Reset</button>
                    <button id="submitBtn" onclick="updateZoneFromClicks()" style="display: none;" disabled class="btn98 btn98-primary" style="font-size: 10px;">SUBMIT</button>
                </div>
            </div>
        </div>

        {# Status #}
        <div class="window">
            <div class="title-bar">
                <span class="title-bar-text">4. Status</span>
            </div>
            <div class="window-body">
                <div id="config-version" class="sunken mono" style="font-size: 10px; padding: 3px 4px; margin-bottom: 4px;"></div>
                <div id="status" class="sunken mono" style="font-size: 10px; padding: 3px 4px;"></div>
                <p style="font-size: 10px; color: var(--text-muted); margin: 4px 0 0;">
                    Select zone &rarr; Show zones &rarr; Adjust &rarr; Click points &rarr; Submit
                </p>
            </div>
        </div>
    </div>
</div>

{# Debug Tools #}
<div class="window" style="margin-top: 8px;">
    <div class="title-bar">
        <span class="title-bar-text">Debug Tools</span>
        <div class="title-bar-controls">
            <button aria-hidden="true" tabindex="-1">&#9472;</button>
            <button aria-hidden="true" tabindex="-1">&#9723;</button>
        </div>
    </div>
    <div class="window-body">
        <div style="display: flex; gap: 4px; margin-bottom: 6px;">
            <button onclick="showCoordinateInfo()" class="btn98" style="font-size: 10px;">Coord Info</button>
            <button onclick="debugCoordinates()" class="btn98" style="font-size: 10px;">Debug Transforms</button>
        </div>
        <div id="coordOutput" class="sunken mono" style="font-size: 10px; padding: 4px; max-height: 150px; overflow: auto; white-space: pre-wrap;"></div>
        <div id="debugOutput" class="sunken mono" style="font-size: 10px; padding: 4px; max-height: 150px; overflow: auto; white-space: pre-wrap; margin-top: 4px;"></div>
    </div>
</div>
{% endblock %}
