{% extends "base.html" %}

{% block title %}Stop Sign Debug{% endblock %}

{% block head_extra %}
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest" defer></script>
<script src="/static/js/video-player.js" defer></script>
<script src="/static/js/debug.js" defer></script>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <h1 class="text-2xl font-bold">Stop Sign Debug Interface</h1>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {# Video stream #}
        <div class="lg:col-span-2">
            <div class="card bg-base-100 shadow-md">
                <div class="card-body p-4">
                    <h2 class="card-title text-sm">Video Stream</h2>
                    <div hx-get="/load-video" hx-trigger="load"
                         class="aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center">
                        <span class="loading loading-spinner loading-lg text-base-content/30"></span>
                    </div>
                </div>
            </div>
        </div>

        {# Controls #}
        <div class="space-y-4">
            {# Zone Selection #}
            <div class="card bg-base-100 shadow-md">
                <div class="card-body p-4">
                    <h3 class="font-bold text-sm">1. Select Zone</h3>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <button id="zone-stop-line" onclick="selectZoneType('stop-line')"
                                class="btn btn-sm btn-primary">Stop Line</button>
                        <button id="zone-pre-stop" onclick="selectZoneType('pre-stop')"
                                class="btn btn-sm btn-outline">Pre-Stop</button>
                        <button id="zone-capture" onclick="selectZoneType('capture')"
                                class="btn btn-sm btn-outline">Capture</button>
                    </div>
                    <p id="zone-instructions" class="text-xs opacity-60 mt-2"></p>
                </div>
            </div>

            {# Visualization #}
            <div class="card bg-base-100 shadow-md">
                <div class="card-body p-4">
                    <h3 class="font-bold text-sm">2. Visualization</h3>
                    <button id="debugZonesBtn" onclick="toggleDebugZones()"
                            class="btn btn-sm btn-outline mt-2">Show Zones</button>
                </div>
            </div>

            {# Actions #}
            <div class="card bg-base-100 shadow-md">
                <div class="card-body p-4">
                    <h3 class="font-bold text-sm">3. Edit Zone</h3>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <button id="adjustmentModeBtn" onclick="toggleAdjustmentMode()"
                                class="btn btn-sm btn-outline">Adjust</button>
                        <button onclick="resetPoints()" class="btn btn-sm btn-outline">Reset</button>
                        <button id="submitBtn" onclick="updateZoneFromClicks()"
                                style="display: none;" disabled
                                class="btn btn-sm btn-success">SUBMIT</button>
                    </div>
                </div>
            </div>

            {# Status #}
            <div class="card bg-base-100 shadow-md">
                <div class="card-body p-4">
                    <h3 class="font-bold text-sm">4. Status</h3>
                    <div id="config-version" class="font-mono text-xs bg-base-200 rounded p-2 mt-2"></div>
                    <div id="status" class="font-mono text-xs bg-base-200 rounded p-2 mt-1"></div>
                    <p class="text-xs opacity-50 mt-2">
                        Select zone &rarr; Show zones &rarr; Adjust &rarr; Click required points (4 for stop zone) &rarr; Submit
                    </p>
                </div>
            </div>
        </div>
    </div>

    {# Debug Tools #}
    <div class="card bg-base-100 shadow-md">
        <div class="card-body p-4">
            <h3 class="font-bold text-sm">Debug Tools</h3>
            <div class="flex gap-2 mt-2">
                <button onclick="showCoordinateInfo()" class="btn btn-sm btn-outline">Coord Info</button>
                <button onclick="debugCoordinates()" class="btn btn-sm btn-outline">Debug Transforms</button>
            </div>
            <div id="coordOutput" class="font-mono text-xs bg-base-200 rounded p-2 mt-2 max-h-40 overflow-auto whitespace-pre-wrap"></div>
            <div id="debugOutput" class="font-mono text-xs bg-base-200 rounded p-2 mt-1 max-h-40 overflow-auto whitespace-pre-wrap"></div>
        </div>
    </div>
</div>
{% endblock %}
