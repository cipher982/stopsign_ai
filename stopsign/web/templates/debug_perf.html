{% extends "base.html" %}

{% block title %}Performance Debug{% endblock %}

{% block content %}
<div class="window" style="max-width: 800px; margin: 0 auto;">
    <div class="title-bar">
        <span class="title-bar-text">Performance Debugging</span>
        <div class="title-bar-controls">
            <button>&#9472;</button>
            <button>&#9723;</button>
        </div>
    </div>
    <div class="window-body">
        <button hx-get="/debug-performance"
                hx-target="#perf-results"
                hx-indicator="#loading"
                class="btn98 btn98-primary" style="font-size: 12px;">
            Run Performance Test
        </button>
        <div id="loading" class="htmx-indicator" style="margin-top: 6px; font-size: 11px; color: var(--text-muted);">
            Running...
        </div>
        <pre class="sunken mono" style="font-size: 11px; padding: 6px; margin-top: 8px; max-height: 400px; overflow: auto; white-space: pre-wrap;"><code id="perf-results"></code></pre>
    </div>
</div>

<script>
document.body.addEventListener('htmx:afterRequest', function(evt) {
    if (evt.detail.target.id === 'perf-results') {
        try {
            const data = JSON.parse(evt.detail.xhr.response);
            evt.detail.target.textContent = JSON.stringify(data, null, 2);
        } catch (e) {
            evt.detail.target.textContent = evt.detail.xhr.response;
        }
    }
});
</script>
{% endblock %}
